import React, { Component } from 'react';
import PropTypes from 'prop-types';

const DEFAULT_IMG_BASE64 =
  'data:image/jpeg;base64,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'; // eslint-disable-line

const ensureDataStructure = mentions =>
  mentions.map(m =>
    Object.assign({}, m, {
      avatar: m.avatar || DEFAULT_IMG_BASE64,
    })
  );

class MentionSuggestionsWrapper extends Component {
  state = {
    mentions: [],
  };

  handleSearchChange = ({ value }) => {
    this.props.settings
      .getMentions(value)
      .then(mentions => this.setState({ mentions: ensureDataStructure(mentions) }));
  };

  onAddMention = m => {
    m.avatar = undefined; // we don't want to save avatar url into editor state
    this.setState({ mentions: [] });
  };

  render() {
    const Comp = this.props.component;
    return (
      <Comp
        onSearchChange={this.handleSearchChange}
        onAddMention={this.onAddMention}
        suggestions={this.state.mentions}
      />
    );
  }
}

MentionSuggestionsWrapper.propTypes = {
  component: PropTypes.func,
  settings: PropTypes.object,
};

export default MentionSuggestionsWrapper;
